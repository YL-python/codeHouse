<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>闭包</title>
</head>

<body>
  <script>
    // 产生缘由，js有两种作用域，全局作用域和局部作用域
    // 函数内可以获取到全局作用域的数值，而全局作用域中却获取不到函数内的数值
    // 有的时候因为某种原因需要获取函数内部的局部变量
    function f1() {
      var n = 999;

      function f2() {
        console.log(n);
      }
      return f2;
    }

    var result = f1();
    // console.log(result);
    result(); // 999

    // 所谓的闭包就是函数 f2 ，定义在函数中的函数

    // 闭包可以读取函数内部的变量，还能使其诞生的环境永远保存
    function createIncrementor(start) {
      return function () {
        return start++;
      };
    }
    var inc = createIncrementor(5);
    inc() // 5
    inc() // 6
    inc() // 7

    // 闭包的另外用处，封装对象的私有属性和私有方法
    function Person(name) {
      var _age;

      function setAge(n) {
        _age = n;
      }

      function getAge() {
        return _age;
      }
      return {
        name: name,
        getAge: getAge,
        setAge: setAge
      };
    }
    var p1 = Person('张三');
    p1.setAge(25);
    p1.getAge() // 25

    // 注意，外层函数每次运行，都会生成一个新的闭包， 而这个闭包又会保留外层函数的内部变量，
    // 所以内存消耗很大。因此不能滥用闭包，否则会造成网页的性能问题。
  </script>
</body>

</html>