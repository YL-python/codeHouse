## 前后端交互 01

## 课堂主题

​ 1）XMLHttpRequest 对象的使用

​ 2）ajax 的封装使用

​ 3）利用 node 搭建服务器提供数据

​ 4）FormData 对象的使用

​ 5）利用 formData 实现多文件上传

​ 6）qq 空间批量上传图片案例

## 课堂目标

- XMLhttpRequet 的使用

- 会使用 ajax 进行数据交互

- 会使用 node 搭建服务器

- 学会使用 FormData 来上传文件

## 视频回顾

- 会使用 XMLHttpRequest 对象实现数据交互

  - 服务端：

    ```js
    const Koa = require('koa');
    const static = require('koa-static');
    const Router = require('koa-router');
    const koaBody = require('koa-body');

    let app = new Koa();
    let router = new Router();
    app.use(static(__dirname + '/static'));
    app.use(
      koaBody({
        multipart: true,
      })
    );
    router.get('/', (ctx) => {
      ctx.body = 'some value...';
    });
    app.use(router.routes());
    app.listen(8989);
    ```

  - xml 数据返还:

    - 重写 response 里的 content-type 内容
    - xhr.overrideMimeType('text/xml; charset = utf-8')

  - post 头部设置

- onreadystatechange 服务器响应信息

  - onload 和 onreadystatechange；

- FormData 对象上传文件

  - upload 事件
    - onloadstart 上传开始
    - onprogress 数据传输进行中
      - evt.total ：需要传输的总大小；
      - evt.loaded :当前上传的文件大小；
    - onabort 上传操作终止
    - onerror 上传失败
    - onload 上传成功
    - onloadend 上传完成（不论成功与否）

## ajax 封装

- 封装成类似下面形式

```js
ajax({
  url: '/xml',
  method: 'post',
  data: {
    hello: '你好',
    height: '178cm',
  },
  success(res) {
    console.log(res);
  },
});
```

## 通过 formData 实现《qq 空间批量上传图片》

- 需求确定
  - 相册内容显示相册
- nodejs 搭建后台
- 分析上传元素
  - 登录区分不同用户
  - 创建上传对象
  - 上传图片
  - 获取上传后的最新图片数据

##总结

​ 1）XMLHttpRequest 对象的使用

​ 2）ajax 的封装使用

​ 3）利用 node 搭建服务器提供数据

​ 4）FormData 对象的使用

​ 5）利用 formData 实现多文件上传

​ 6）通过 async 和 await 处理异步

​ 7）qq 空间批量上传图片案例

## 下期预告

​ 前后端交互 02
